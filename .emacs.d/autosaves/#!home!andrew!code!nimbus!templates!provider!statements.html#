{% extends "provider/provider_admin.html" %}
{% block extrahead %}
  {{ super() }}
<style type="text/css" media="all">
#statement_area {
    font-size: 120%;
}
span.label {
    font-weight: bold;
}
h3 a {
    font-weight: normal;
    font-size: 90%;
}
</style>
{% endblock %}

{% block contentbody %}
  <h2>Statements</h2>
  <div id="statement_area">
    {% if annual_statement %}
      <p style="margin-top: 10px;">
	<span class="label">Account Number:</span> {{ annual_statement.party.account_number }}<br>
	<span class="label">Current Period Earnings:</span> {{ "$%s"%commafy(annual_statement[month].amount) if annual_statement[month] else "Not generated" }}<br>
	<span class="label">YTD Earnings:</span> ${{ commafy(annual_statement.amount) }}<br>
	<span class="label">Terms:</span> {{ provider.payment_terms }}
      </p>
      {% for statement in annual_statement %}
	  <h3>
	    {{ statement.period.index|month_name }}, {{ statement.year }} 
	    {% if export_url and statement.published %}
	      &nbsp;<a href="{{ export_url(statement.period.index) }}"><img src="/static/images/pdficon_small.gif" alt="(export)" /></a>&nbsp;
	    {% endif %}
	    {% if publish_url %}
	      <a href="{{ publish_url(statement) }}">({{ "un" if statement.published }}publish)</a>
	    {% endif %}
	    {% if loop.first and notify_url %}
	      <a href="{{ notify_url }}" onclick="return confirm('Are you sure you want to send a notification to {{ ",".split(provider.email) }} about their {{ statement.period.index|month_name }} statement?');">(Notify Provider)</a>
	    {% endif %}
	  </h3>
	  <table class="common_table">
	    <tr>
	      <th>Campaign</th>
	      <th>Volume</th>
	      <th>$ / Unit</th>
	      <th>Earnings</th>
	    </tr>
	    {% for datum in statement.data %}
	      <tr>
		<td>{{ datum.label }}</td>
		<td>{{ commafy(datum.volume) }}</td>
		<td>${{ rate_fmt(datum.rate) }}</td>
		<td>${{ commafy(datum.amount) }}</td>
	      </tr>
	    {% endfor %}
	  </table>
      {% endfor %}
    {% else %}
      <p><b>No statement information found.</b></p>
    {% endif %}
    {% if request.user.is_staff and missing_months %}
      <div class="action_container">
	<form method="post" action="{{ generate_url }}">
	  <select name="statement_month">
	    {% for month_num in missing_months %}
	      <option value="{{ month_num }}">{{ month_num|month_name  }}</option>
	    {% endfor %}
	  </select>
	  <input type="submit" value="Generate statement" />
	</form>
      </div>
    {% endif %}
  </div>
{% endblock %}
